<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OLYMPIAN | ELEMENTAL</title>
    <style>
        :root { --fire-glow: #ffae00; --fire-core: #ff4500; --lightning: #00f2ff; --water: #0044ff; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; transition: background 5s ease; font-family: 'Courier New', monospace; color: white; overflow: hidden; }
        canvas#fractalCanvas { position: fixed; top: 0; left: 0; z-index: 0; pointer-events: none; }
        header { position: relative; z-index: 100; height: 60px; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; background: rgba(0,0,0,0.8); border-bottom: 1px solid var(--fire-core); }
        h1 { letter-spacing: 5px; color: var(--fire-glow); text-shadow: 0 0 10px var(--fire-core); font-size: 0.9rem; }
        
        /* WATER & LIGHTNING TRANSPARENT FRAMES */
        #store-grid { position: relative; z-index: 5; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 95%; margin: 15px auto; overflow-y: auto; height: calc(100vh - 170px); padding: 10px; scrollbar-width: none; }
        
        .card { 
            position: relative; 
            background: rgba(255, 255, 255, 0.02); 
            border: 1px solid rgba(0, 242, 255, 0.3); /* Lightning hint */
            aspect-ratio: 1/1; 
            cursor: pointer; 
            overflow: hidden;
            box-shadow: 0 0 15px rgba(0, 68, 255, 0.2); /* Water glow */
            animation: elemental-pulse 3s infinite alternate;
        }

        @keyframes elemental-pulse {
            0% { border-color: var(--lightning); box-shadow: 0 0 5px var(--water); }
            100% { border-color: var(--water); box-shadow: 0 0 20px var(--lightning); }
        }

        .card img { 
            width: 100%; height: 100%; object-fit: contain; 
            mix-blend-mode: screen; 
            filter: contrast(1.1) brightness(1.1); 
        }
        
        .grid-label { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.7); font-size: 0.55rem; text-align: center; padding: 6px 0; color: #fff; border-top: 1px solid var(--lightning); }
        #modal-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 1000; display: none; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); align-items: center; justify-content: center; }
        .modal-content { width: 90%; max-width: 400px; background: #000; border: 2px solid var(--lightning); position: relative; padding-bottom: 20px; }
        #modal-img-container img { width: 100%; mix-blend-mode: screen; }
        
        .size-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin: 15px 20px; }
        .size-btn { border: 1px solid var(--lightning); background: #000; color: #fff; padding: 10px 0; cursor: pointer; font-size: 0.65rem; }
        .size-btn.selected { background: var(--lightning); color: #000; font-weight: bold; }
        
        .pagination-container { position: fixed; bottom: 0; width: 100%; height: 80px; background: rgba(0,0,0,0.9); z-index: 150; display: flex; flex-direction: column; align-items: center; justify-content: center; border-top: 1px solid var(--fire-core); }
        .sector-slider { width: 80%; accent-color: var(--fire-glow); }
        #sector-display { font-size: 0.7rem; color: var(--fire-glow); margin-bottom: 5px; letter-spacing: 2px; }
        #side-cart { position: fixed; top: 0; right: -100%; width: 85%; max-width: 350px; height: 100%; background: #050505; border-left: 1px solid var(--fire-glow); z-index: 2000; transition: 0.4s; display: flex; flex-direction: column; }
        #side-cart.open { right: 0; }
        .pay-link { display: block; width: 90%; margin: 10px auto; padding: 15px 0; text-align: center; font-size: 0.8rem; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body ondblclick="closeModal(); toggleCart(false)">
<canvas id="fractalCanvas"></canvas>
<header><h1>OLYMPIAN AXIOM</h1><div id="cart-trigger" onclick="toggleCart(true)" style="color:var(--lightning); border-color:var(--lightning)">MANIFEST (0)</div></header>
<div id="store-grid"></div>
<div id="side-cart">
    <div style="padding:20px; border-bottom:1px solid var(--fire-glow); display:flex; justify-content:space-between;"><span style="color:var(--fire-glow)">CURRENT MANIFEST</span><span onclick="toggleCart(false)" style="cursor:pointer;">Ã—</span></div>
    <div id="cart-items" style="flex:1; overflow-y:auto; padding:20px;"></div>
    <div style="padding: 20px; border-top: 1px solid var(--fire-glow);">
        <a href="https://buy.stripe.com/4gMaEWdE3dha4GUgBAcIE01" class="pay-link" style="background:#fff; color:#000;" target="_blank">STRIPE GATEWAY</a>
        <a href="https://nowpayments.io/payment/?iid=6087329696" class="pay-link" style="background:var(--fire-core); color:#fff;" target="_blank">CRYPTO GATEWAY</a>
    </div>
</div>
<div id="modal-overlay" onclick="closeModal()"><div class="modal-content" onclick="event.stopPropagation()"><div id="modal-img-container"></div><div style="padding:0 20px;"><div id="modal-title" style="color:var(--lightning); font-size:0.8rem; margin-bottom:10px;"></div><div class="size-grid"><button class="size-btn" onclick="selectSize(this, 'S')">S</button><button class="size-btn" onclick="selectSize(this, 'M')">M</button><button class="size-btn" onclick="selectSize(this, 'L')">L</button><button class="size-btn" onclick="selectSize(this, 'XL')">XL</button><button class="size-btn" onclick="selectSize(this, '2XL')">2XL</button><button class="size-btn" onclick="selectSize(this, '3XL')">3XL</button><button class="size-btn" onclick="selectSize(this, '4XL')">4XL</button><button class="size-btn" onclick="selectSize(this, '5XL')">5XL</button><button class="size-btn" onclick="selectSize(this, '6XL')">6XL</button></div><button onclick="addToCart()" style="width:100%; padding:15px; background:var(--lightning); border:none; font-weight:bold; cursor:pointer; color:#000;">UPLOAD TO MANIFEST</button></div></div></div>
<div class="pagination-container"><div id="sector-display">INITIALIZING...</div><input type="range" id="sector-slider" class="sector-slider" min="1" max="1" value="1"></div>

<script>
let allProducts = [], cart = [], itemsPerPage = 20, selectedSize = null, activeProduct = null;

// --- DATA ENGINE ---
async function fetchStore() {
    try {
        const res = await fetch('/api/artemis-2');
        const data = await res.json();
        if (data.products) { allProducts = data.products; setupNavigation(); renderGrid(1); }
    } catch (e) { document.getElementById('sector-display').innerText = "LINK SEVERED"; }
}

function setupNavigation() {
    const slider = document.getElementById('sector-slider'); const display = document.getElementById('sector-display');
    const totalPages = Math.ceil(allProducts.length / itemsPerPage); slider.max = totalPages;
    display.innerText = `SECTOR 01 / ${totalPages.toString().padStart(2, '0')}`;
    slider.oninput = (e) => { display.innerText = `SECTOR ${e.target.value.padStart(2, '0')} / ${totalPages.toString().padStart(2, '0')}`; renderGrid(parseInt(e.target.value)); };
}

function renderGrid(page) {
    const grid = document.getElementById('store-grid'); const items = allProducts.slice((page-1)*itemsPerPage, page*itemsPerPage);
    grid.innerHTML = items.map(p => `<div class="card" onclick="openModal('${p.name.replace(/'/g, "\\'")}', '${p.images[0]}')"><img src="${p.images[0]}" loading="lazy"><div class="grid-label">${p.name.split('Prompt:')[1] || 'OLYMPIAN'}</div></div>`).join('');
    grid.scrollTop = 0;
}

function openModal(name, img) { activeProduct = { name, img }; selectedSize = null; document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('selected')); document.getElementById('modal-title').innerText = name; document.getElementById('modal-img-container').innerHTML = `<img src="${img}">`; document.getElementById('modal-overlay').style.display = 'flex'; }
function selectSize(btn, size) { selectedSize = size; document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); }
function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }
function toggleCart(show) { document.getElementById('side-cart').classList.toggle('open', show); }
function addToCart() { if(!selectedSize) return alert("SELECT SIZE"); cart.push({...activeProduct, size: selectedSize}); document.getElementById('cart-trigger').innerText = `MANIFEST (${cart.length})`; document.getElementById('cart-items').innerHTML = cart.map(i => `<div style="padding:10px; border-bottom:1px solid #222; font-size:0.7rem;">${i.name}<br><span style="color:var(--lightning)">SIZE: ${i.size}</span></div>`).join(''); closeModal(); toggleCart(true); }

// --- DAY/NIGHT & ELEMENTAL ENGINE ---
const canvas = document.getElementById('fractalCanvas'); const ctx = canvas.getContext('2d'); 
let w, h, treeSegments = [], worldY = 0, lastTreeY = 0, cycleTime = 0;

function resize() { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; }

function gen(x, y, a, l, d) { 
    if (d > 8) return; 
    const x2 = x + Math.cos(a) * l, y2 = y + Math.sin(a) * l; 
    treeSegments.push({x1:x, y1:y, x2:x2, y2:y2, d}); 
    gen(x2, y2, a - 0.35, l * 0.8, d + 1); 
    gen(x2, y2, a + 0.35, l * 0.8, d + 1); 
}

function loop() {
    worldY -= 4;
    cycleTime += 0.002; // Speed of day/night cycle
    
    // Calculate Background Color (Night: black, Day: deep blue-grey)
    const dayIntensity = (Math.sin(cycleTime) + 1) / 2;
    const r = Math.floor(dayIntensity * 20);
    const g = Math.floor(dayIntensity * 30);
    const b = Math.floor(dayIntensity * 50);
    document.body.style.backgroundColor = `rgb(${r},${g},${b})`;

    if (lastTreeY > worldY - h) { 
        gen(w/2 + Math.sin(worldY*0.001)*100, lastTreeY, -Math.PI/2, 90, 0); 
        lastTreeY -= 400; 
    }

    ctx.clearRect(0, 0, w, h); // Clear for transparency
    ctx.lineWidth = 1.5;
    
    treeSegments.forEach(s => {
        const y1 = s.y1 - worldY, y2 = s.y2 - worldY;
        if(y1 < h + 100 && y2 > -100) {
            // Flaming trees during night, Glowing blue during day
            ctx.strokeStyle = `rgb(255, ${120 - s.d*12}, ${dayIntensity * 255})`;
            ctx.beginPath(); ctx.moveTo(s.x1, y1); ctx.lineTo(s.x2, y2); ctx.stroke();
        }
    });

    if(treeSegments.length > 1000) treeSegments.splice(0, 50);
    requestAnimationFrame(loop);
}

window.onresize = resize; resize(); lastTreeY = h; loop(); fetchStore();
</script>
</body>
</html>
