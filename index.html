<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OLYMPIAN | AXIOM 24</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        :root { --fire: #ff4500; --spark: #ffae00; --bio-low: #001a33; --bio-high: #00f2ff; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; font-family: 'Courier New', monospace; color: white; overflow: hidden; }
        
        /* Background Canvas Styling */
        canvas#hurricaneCanvas { position: fixed; top: 0; left: 0; z-index: 0; pointer-events: none; }
        
        header { position: relative; z-index: 100; height: 60px; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; background: rgba(0,0,0,0.85); border-bottom: 1px solid var(--bio-high); }
        h1 { letter-spacing: 5px; color: var(--bio-high); text-shadow: 0 0 15px var(--bio-high); font-size: 0.9rem; }

        #store-grid { 
            position: relative; z-index: 5; 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 15px; 
            width: 95%; 
            margin: 15px auto; 
            height: calc(100vh - 180px); 
            overflow-y: auto; 
            scrollbar-width: none;
            padding-bottom: 50px;
        }

        .card { 
            position: relative; 
            background: rgba(0, 242, 255, 0.03); 
            border: 1px solid rgba(0, 242, 255, 0.2);
            aspect-ratio: 0.8 / 1; 
            cursor: pointer; 
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 0 15px var(--bio-low);
            transition: 0.3s;
            backdrop-filter: blur(2px);
        }
        .card:hover { border-color: var(--bio-high); box-shadow: 0 0 20px var(--bio-high); }

        .card img { 
            width: 85%; height: 85%; object-fit: contain; 
            mix-blend-mode: screen; 
            filter: drop-shadow(0 0 8px var(--bio-high)); 
        }

        .grid-label { position: absolute; bottom: 0; width: 100%; background: rgba(0,26,51,0.9); font-size: 0.55rem; text-align: center; padding: 6px 0; color: var(--bio-high); border-top: 1px solid var(--bio-high); }

        #modal-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 1000; display: none; background: rgba(0,0,0,0.95); backdrop-filter: blur(12px); align-items: center; justify-content: center; }
        .modal-content { 
            width: 90%; max-width: 420px; background: #000; 
            border: 2px solid var(--bio-high); 
            position: relative; padding-bottom: 20px; 
            box-shadow: 0 0 40px var(--bio-low);
        }
        .close-modal { position: absolute; top: 10px; right: 15px; font-size: 1.8rem; color: var(--bio-high); cursor: pointer; z-index: 100; }
        
        .size-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin: 15px 20px; }
        .size-btn { border: 1px solid var(--bio-high); background: #000; color: #fff; padding: 12px 0; cursor: pointer; font-size: 0.65rem; }
        .size-btn.selected { background: var(--bio-high); color: #000; font-weight: bold; }

        .pagination-container { position: fixed; bottom: 0; width: 100%; height: 80px; background: rgba(0,0,0,0.9); z-index: 150; display: flex; flex-direction: column; align-items: center; justify-content: center; border-top: 1px solid var(--bio-high); }
        .sector-slider { width: 80%; accent-color: var(--bio-high); }
        #sector-display { font-size: 0.7rem; color: var(--bio-high); margin-bottom: 5px; letter-spacing: 2px; }

        #side-cart { position: fixed; top: 0; right: -100%; width: 85%; max-width: 350px; height: 100%; background: #000; border-left: 1px solid var(--bio-high); z-index: 2000; transition: 0.4s; }
        #side-cart.open { right: 0; }
        .pay-link { display: block; width: 90%; margin: 10px auto; padding: 15px 0; text-align: center; font-size: 0.8rem; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body ondblclick="closeModal(); toggleCart(false)">

<canvas id="hurricaneCanvas"></canvas>

<header>
    <h1>OLYMPIAN</h1>
    <div id="cart-trigger" onclick="toggleCart(true)" style="color:var(--bio-high); border:1px solid var(--bio-high); padding:8px 15px; font-size:0.8rem; cursor:pointer;">MANIFEST (0)</div>
</header>

<div id="store-grid"></div>

<div id="modal-overlay" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <span class="close-modal" onclick="closeModal()">×</span>
        <div id="modal-img-container" style="padding:10px;"></div>
        <div style="padding:0 20px;">
            <div id="modal-title" style="color:var(--bio-high); font-size:0.8rem; margin-bottom:10px; text-transform:uppercase; text-align:center;"></div>
            <div class="size-grid">
                <button class="size-btn" onclick="selectSize(this, 'S')">S</button>
                <button class="size-btn" onclick="selectSize(this, 'M')">M</button>
                <button class="size-btn" onclick="selectSize(this, 'L')">L</button>
                <button class="size-btn" onclick="selectSize(this, 'XL')">XL</button>
                <button class="size-btn" onclick="selectSize(this, '2XL')">2XL</button>
                <button class="size-btn" onclick="selectSize(this, '3XL')">3XL</button>
                <button class="size-btn" onclick="selectSize(this, '4XL')">4XL</button>
                <button class="size-btn" onclick="selectSize(this, '5XL')">5XL</button>
                <button class="size-btn" onclick="selectSize(this, '6XL')">6XL</button>
            </div>
            <button onclick="addToCart()" style="width:100%; padding:15px; background:var(--bio-high); border:none; font-weight:bold; cursor:pointer; color:#000;">UPLOAD TO MANIFEST</button>
        </div>
    </div>
</div>

<div id="side-cart">
    <div style="padding:20px; border-bottom:1px solid var(--bio-high); display:flex; justify-content:space-between;"><span style="color:var(--bio-high)">MANIFEST</span><span onclick="toggleCart(false)" style="cursor:pointer;">×</span></div>
    <div id="cart-items" style="padding:20px; font-size:0.7rem;"></div>
    <div style="position:absolute; bottom:20px; width:100%;">
        <a href="https://buy.stripe.com/4gMaEWdE3dha4GUgBAcIE01" class="pay-link" style="background:#fff; color:#000;" target="_blank">STRIPE</a>
        <a href="https://nowpayments.io/payment/?iid=6087329696" class="pay-link" style="background:var(--fire); color:#fff;" target="_blank">CRYPTO</a>
    </div>
</div>

<div class="pagination-container">
    <div id="sector-display">SYNCING...</div>
    <input type="range" id="sector-slider" class="sector-slider" min="1" max="1" value="1">
</div>

<script>
// --- STORE LOGIC (UNTOUCHED) ---
let allProducts = [], cart = [], itemsPerPage = 24, selectedSize = null, activeProduct = null;

async function fetchStore() {
    try {
        const res = await fetch('/api/artemis-2');
        const data = await res.json();
        if (data.products) { 
            allProducts = data.products; 
            setupNavigation();
            renderGrid(1); 
        }
    } catch (e) { document.getElementById('sector-display').innerText = "LINK SEVERED"; }
}

function setupNavigation() {
    const slider = document.getElementById('sector-slider');
    const display = document.getElementById('sector-display');
    const totalPages = Math.ceil(allProducts.length / itemsPerPage);
    slider.max = totalPages;
    display.innerText = `SECTOR 01 / ${totalPages.toString().padStart(2, '0')}`;
    slider.oninput = (e) => {
        display.innerText = `SECTOR ${e.target.value.padStart(2, '0')} / ${totalPages.toString().padStart(2, '0')}`;
        renderGrid(parseInt(e.target.value));
    };
}

function renderGrid(page) {
    const grid = document.getElementById('store-grid');
    const start = (page - 1) * itemsPerPage;
    const items = allProducts.slice(start, start + itemsPerPage);
    grid.innerHTML = items.map(p => `
        <div class="card" onclick="openModal('${p.name.replace(/'/g, "\\'")}', '${p.images[0]}')">
            <img src="${p.images[0]}" loading="lazy">
            <div class="grid-label">${p.name.split('Prompt:')[1] || 'OLYMPIAN'}</div>
        </div>`).join('');
    grid.scrollTop = 0;
}

function openModal(name, img) {
    activeProduct = { name, img }; selectedSize = null;
    document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('selected'));
    document.getElementById('modal-title').innerText = name;
    document.getElementById('modal-img-container').innerHTML = `<img src="${img}" style="width:100%; mix-blend-mode:screen; filter:drop-shadow(0 0 15px var(--bio-high));">`;
    document.getElementById('modal-overlay').style.display = 'flex';
}

function selectSize(btn, size) { selectedSize = size; document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); }
function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }
function toggleCart(show) { document.getElementById('side-cart').classList.toggle('open', show); }
function addToCart() {
    if(!selectedSize) return alert("SELECT SIZE");
    cart.push({...activeProduct, size: selectedSize});
    document.getElementById('cart-trigger').innerText = `MANIFEST (${cart.length})`;
    document.getElementById('cart-items').innerHTML = cart.map(i => `<div style="padding:10px; border-bottom:1px solid #111;">${i.name}<br><span style="color:var(--bio-high)">${i.size}</span></div>`).join('');
    closeModal(); toggleCart(true);
}

// --- HURRICANE ENGINE: REPLACED FALLING TREES ---
let scene, camera, renderer, clock = new THREE.Clock();
let clouds = [], rain, ocean, hurricaneGroup;
let shakeIntensity = 0, lightningFlash = 0;

function initHurricane() {
    scene = new THREE.Scene();
    scene.fog = new THREE.FogExp2(0x000606, 0.004);

    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 3500);
    camera.position.set(0, 150, 450);

    const canvas = document.getElementById('hurricaneCanvas');
    renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setClearColor(0x000000);

    hurricaneGroup = new THREE.Group();
    scene.add(hurricaneGroup);

    const oceanGeo = new THREE.PlaneGeometry(3500, 3500, 100, 100);
    const oceanMat = new THREE.MeshStandardMaterial({ color: 0x001111, metalness: 0.98, roughness: 0.02, flatShading: true });
    ocean = new THREE.Mesh(oceanGeo, oceanMat);
    ocean.rotation.x = -Math.PI / 2;
    scene.add(ocean);

    const cloudGeo = new THREE.IcosahedronGeometry(22, 1);
    for (let i = 0; i < 250; i++) {
        const cloudMat = new THREE.MeshLambertMaterial({ color: 0x020202, transparent: true, opacity: 0.5 });
        const cloud = new THREE.Mesh(cloudGeo, cloudMat);
        const angle = i * 0.16;
        const dist = 70 + (i * 1.9);
        cloud.position.set(Math.cos(angle) * dist, 130 + (Math.random() * 90), Math.sin(angle) * dist);
        cloud.scale.set(Math.random() * 9 + 5, Math.random() * 4 + 1, Math.random() * 9 + 5);
        hurricaneGroup.add(cloud);
        clouds.push(cloud);
    }

    const rainGeo = new THREE.BufferGeometry();
    const rainPos = [];
    for (let i = 0; i < 35000; i++) {
        rainPos.push((Math.random() - 0.5) * 3000, Math.random() * 1500, (Math.random() - 0.5) * 3000);
    }
    rainGeo.setAttribute('position', new THREE.Float32BufferAttribute(rainPos, 3));
    rain = new THREE.Points(rainGeo, new THREE.PointsMaterial({ color: 0x00ffaa, size: 0.28, transparent: true, opacity: 0.45 }));
    scene.add(rain);

    scene.add(new THREE.AmbientLight(0x001a1a, 0.45));
    animate();
}

function triggerLightning() {
    const colors = [0x00ffaa, 0x00ffff, 0xffffff, 0x4488ff, 0xaa00ff];
    const col = colors[Math.floor(Math.random() * colors.length)];
    const x = (Math.random() - 0.5) * 1500, z = (Math.random() - 0.5) * 1500;
    const pts = [];
    let curr = new THREE.Vector3(x, 600, z);
    for(let i=0; i<18; i++) {
        pts.push(curr.clone());
        curr.add(new THREE.Vector3((Math.random()-0.5)*140, -40, (Math.random()-0.5)*140));
    }
    const geo = new THREE.BufferGeometry().setFromPoints(pts);
    const line = new THREE.Line(geo, new THREE.LineBasicMaterial({ color: col, linewidth: 4 }));
    const light = new THREE.PointLight(col, 800, 2500);
    light.position.set(x, 300, z);
    scene.add(line); scene.add(light);
    shakeIntensity = 15; lightningFlash = 3.0;
    setTimeout(() => { scene.remove(line); scene.remove(light); }, 45 + Math.random() * 55);
}

function animate() {
    requestAnimationFrame(animate);
    const time = clock.getElapsedTime();
    if (Math.random() > 0.96) triggerLightning();

    const verts = ocean.geometry.attributes.position.array;
    for (let i = 0; i < verts.length; i += 3) {
        const x = verts[i], y = verts[i+1];
        const d = Math.sqrt(x*x + y*y);
        verts[i+2] = Math.sin(d * 0.015 - time * 5.5) * 35 + Math.cos(x * 0.09 + time * 4.5) * 17.5;
    }
    ocean.geometry.attributes.position.needsUpdate = true;
    hurricaneGroup.rotation.y += 0.018;

    const rArray = rain.geometry.attributes.position.array;
    for (let i = 0; i < rArray.length; i += 3) {
        rArray[i+1] -= 18;
        if (rArray[i+1] < 0) rArray[i+1] = 1500;
    }
    rain.geometry.attributes.position.needsUpdate = true;

    camera.position.x = (Math.sin(time * 0.08) * 600) + (Math.random() - 0.5) * shakeIntensity;
    camera.position.z = (Math.cos(time * 0.08) * 600) + (Math.random() - 0.5) * shakeIntensity;
    camera.lookAt(0, 80, 0);

    if (shakeIntensity > 0) shakeIntensity *= 0.88;
    if (lightningFlash > 0) {
        scene.fog.color.setScalar(lightningFlash * 0.4);
        lightningFlash *= 0.93;
    }
    renderer.render(scene, camera);
}

window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});

// INITIALIZE
initHurricane();
fetchStore();
</script>
</body>
</html>
