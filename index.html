<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OLYMPIAN HOODIES | AXIOM</title>
    <style>
        :root { --fire-glow: #ffae00; --fire-core: #ff4500; --header-h: 60px; --pagi-h: 75px; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; font-family: 'Courier New', monospace; color: white; overflow: hidden; }
        canvas#fractalCanvas { position: fixed; top: 0; left: 0; z-index: 0; pointer-events: none; }
        
        header { position: relative; z-index: 100; height: var(--header-h); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; background: rgba(0,0,0,0.8); border-bottom: 1px solid var(--fire-core); }
        h1 { letter-spacing: 5px; color: var(--fire-glow); text-shadow: 0 0 10px var(--fire-core); font-size: 0.9rem; margin: 0; }
        #cart-trigger { cursor: pointer; color: var(--fire-glow); border: 1px solid var(--fire-glow); padding: 8px 15px; font-size: 0.8rem; background: rgba(255,174,0,0.1); }

        /* SCROLLABLE GRID */
        #store-grid { flex: 1; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 95%; margin: 15px auto; overflow-y: auto; height: calc(100vh - 165px); padding-bottom: 120px; z-index: 5; position: relative; scrollbar-width: none; }
        .card { position: relative; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 174, 0, 0.1); aspect-ratio: 1/1; cursor: pointer; }
        .card img { width: 100%; height: 100%; object-fit: contain; }
        .grid-label { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.7); font-size: 0.5rem; text-align: center; padding: 5px 0; color: var(--fire-glow); }

        /* PRODUCT MODAL */
        #modal-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 1000; display: none; background: transparent; }
        .modal-content { width: 95%; max-width: 450px; margin: 20px auto; background: rgba(0, 0, 0, 0.2); border: 2px solid var(--fire-glow); position: relative; box-shadow: 0 0 100px rgba(255, 69, 0, 0.5); backdrop-filter: blur(4px); padding-bottom: 20px; }
        
        .size-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin-bottom: 20px; }
        .size-btn { border: 1px solid var(--fire-glow); background: rgba(0,0,0,0.8); color: #fff; padding: 10px 0; cursor: pointer; font-family: inherit; font-size: 0.7rem; }
        .size-btn.selected { background: var(--fire-glow); color: #000; font-weight: bold; }

        .qty-controls { display: flex; align-items: center; gap: 20px; margin: 10px 0; border: 1px solid var(--fire-glow); width: fit-content; padding: 8px 15px; background: rgba(0,0,0,0.8); }
        .add-to-cart-btn { width: 100%; padding: 20px; background: var(--fire-glow); color: #000; font-weight: bold; border: none; cursor: pointer; text-transform: uppercase; letter-spacing: 2px; }

        /* MANIFEST SIDEBAR */
        #side-cart { position: fixed; top: 0; right: -100%; width: 85%; max-width: 400px; height: 100%; background: rgba(5, 5, 5, 0.98); border-left: 1px solid var(--fire-glow); z-index: 2000; transition: 0.4s; display: flex; flex-direction: column; }
        #side-cart.open { right: 0; }
        .cart-items { flex: 1; overflow-y: auto; padding: 20px; }
        .pay-link { display: block; width: 100%; padding: 18px 0; text-align: center; font-size: 0.8rem; font-weight: bold; text-decoration: none; margin-top: 10px; }
        .fiat { background: #fff; color: #000; }
        .crypto { background: var(--fire-core); color: #fff; }

        /* FOOTER / PAGINATION */
        .pagination-container { position: fixed; bottom: 0; width: 100%; height: var(--pagi-h); background: rgba(0,0,0,0.9); z-index: 150; display: flex; flex-direction: column; align-items: center; justify-content: center; border-top: 1px solid var(--fire-core); }
        .page-num { font-size: 1.1rem; color: rgba(255, 255, 255, 0.2); cursor: pointer; min-width: 35px; text-align: center; }
        .page-num.active { color: var(--fire-glow); font-weight: bold; }
    </style>
</head>
<body ondblclick="closeModal(); toggleCart(false)">

<canvas id="fractalCanvas"></canvas>
<header>
    <h1>OLYMPIAN</h1>
    <div id="cart-trigger" onclick="toggleCart(true)">MANIFEST (0)</div>
</header>

<div id="store-grid"></div>

<div id="side-cart">
    <div style="padding:20px; border-bottom:1px solid var(--fire-glow); display:flex; justify-content:space-between;">
        <span style="color:var(--fire-glow)">MANIFEST</span>
        <span onclick="toggleCart(false)" style="cursor:pointer;">Ã—</span>
    </div>
    <div class="cart-items" id="cart-items-container"></div>
    <div style="padding: 20px; border-top: 1px solid var(--fire-glow);">
        <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
            <span>TOTAL</span>
            <span id="cart-total" style="color:var(--fire-glow)">$0.00</span>
        </div>
        <a href="https://buy.stripe.com/7sI02L9Xk0M1gE08wx" class="pay-link fiat" target="_blank">STRIPE GATEWAY</a>
        <a href="https://nowpayments.io/payment/?iid=6145326581" class="pay-link crypto" target="_blank">CRYPTO GATEWAY</a>
    </div>
</div>

<div id="modal-overlay" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div id="modal-img-container" style="width:100%; aspect-ratio:1/1; display:flex; align-items:center; justify-content:center;"></div>
        <div style="padding:20px;">
            <div id="modal-title" style="color:var(--fire-glow); margin-bottom:15px; font-size:0.9rem; text-shadow: 2px 2px #000;"></div>
            <div style="font-size:0.6rem; margin-bottom:8px;">SIZE SELECTION (S-6XL):</div>
            <div class="size-grid">
                <button class="size-btn" onclick="selectSize(this, 'S')">S</button>
                <button class="size-btn" onclick="selectSize(this, 'M')">M</button>
                <button class="size-btn" onclick="selectSize(this, 'L')">L</button>
                <button class="size-btn" onclick="selectSize(this, 'XL')">XL</button>
                <button class="size-btn" onclick="selectSize(this, '2XL')">2XL</button>
                <button class="size-btn" onclick="selectSize(this, '3XL')">3XL</button>
                <button class="size-btn" onclick="selectSize(this, '4XL')">4XL</button>
                <button class="size-btn" onclick="selectSize(this, '5XL')">5XL</button>
                <button class="size-btn" onclick="selectSize(this, '6XL')">6XL</button>
            </div>
            <div style="font-size:0.6rem; margin-bottom:8px;">QUANTITY:</div>
            <div class="qty-controls">
                <button style="background:none; border:none; color:var(--fire-glow); cursor:pointer; font-size:1.2rem;" onclick="changeQty(-1)">-</button>
                <span id="qty-val">1</span>
                <button style="background:none; border:none; color:var(--fire-glow); cursor:pointer; font-size:1.2rem;" onclick="changeQty(1)">+</button>
            </div>
            <button class="add-to-cart-btn" onclick="addToCart()">UPLOAD TO MANIFEST</button>
        </div>
    </div>
</div>

<div class="pagination-container">
    <div id="gather-status" style="font-size: 0.6rem; color: var(--fire-glow); margin-bottom: 4px;">SYNCING ARCHIVE...</div>
    <div class="pagination-bar" id="pagination-bar" style="display:flex; gap:15px;"></div>
</div>

<script>
let allProducts = [], cart = [], currentPage = 0, itemsPerPage = 24;
let selectedSize = null, activeProduct = null, modalQty = 1;

// THE MULTI-PULL HARVESTER LOGIC
async function fetchStore(page = 0) {
    try {
        const res = await fetch(`/.netlify/functions/get-products?page=${page}`);
        const data = await res.json();
        
        if (page === 0) allProducts = [];
        
        if (data.products && data.products.length > 0) {
            allProducts = [...allProducts, ...data.products];
            renderGrid();
        }

        const total = data.total || 0;
        document.getElementById('gather-status').innerText = `AXIOM ARCHIVE: ${allProducts.length} / ${total}`;

        // Chain to the next set of 100 if more exist
        if (allProducts.length < total && allProducts.length < 1000) {
            setTimeout(() => fetchStore(page + 1), 350);
        } else {
            document.getElementById('gather-status').innerText = "SYNC COMPLETE";
        }
    } catch (e) { 
        document.getElementById('gather-status').innerText = "LINK INTERRUPTED"; 
    }
}

function renderGrid() {
    const grid = document.getElementById('store-grid');
    const start = currentPage * itemsPerPage;
    const end = Math.min(start + itemsPerPage, allProducts.length);
    
    const items = allProducts.slice(start, end);
    grid.innerHTML = items.map(p => `
        <div class="card" onclick="openModal('${p.name}', '${p.images[0]}')">
            <img src="${p.images[0]}">
            <div class="grid-label">${p.name}</div>
        </div>
    `).join('');
    renderPagination();
}

function renderPagination() {
    const bar = document.getElementById('pagination-bar');
    const pageCount = Math.ceil(allProducts.length / itemsPerPage);
    if (pageCount <= 1) { bar.innerHTML = ""; return; }
    bar.innerHTML = Array.from({length: pageCount}, (_, i) => 
        `<div class="page-num ${i === currentPage ? 'active' : ''}" onclick="event.stopPropagation(); goToPage(${i})">${i + 1}</div>`
    ).join('');
}

function goToPage(p) { currentPage = p; renderGrid(); document.getElementById('store-grid').scrollTop = 0; }
function openModal(name, img) {
    activeProduct = { name, img }; selectedSize = null; modalQty = 1;
    document.getElementById('qty-val').innerText = "1";
    document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('selected'));
    document.getElementById('modal-title').innerText = name;
    document.getElementById('modal-img-container').innerHTML = `<img src="${img}" style="max-width:90%; max-height:90%;">`;
    document.getElementById('modal-overlay').style.display = 'flex';
}
function selectSize(btn, size) {
    selectedSize = size;
    document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
}
function changeQty(amt) { modalQty = Math.max(1, modalQty + amt); document.getElementById('qty-val').innerText = modalQty; }
function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }
function toggleCart(show) { document.getElementById('side-cart').classList.toggle('open', show); }
function addToCart() {
    if (!selectedSize) { alert("SELECT SIZE"); return; }
    const existing = cart.find(i => i.name === activeProduct.name && i.size === selectedSize);
    if (existing) existing.qty += modalQty;
    else cart.push({...activeProduct, size: selectedSize, qty: modalQty, id: Date.now()});
    updateCartUI(); closeModal(); toggleCart(true);
}
function removeFromCart(id) { cart = cart.filter(i => i.id !== id); updateCartUI(); }
function updateCartUI() {
    const container = document.getElementById('cart-items-container');
    document.getElementById('cart-trigger').innerText = `MANIFEST (${cart.reduce((s, i) => s + i.qty, 0)})`;
    container.innerHTML = cart.map(i => `
        <div class="cart-item" style="display:flex; gap:10px; margin-bottom:15px; align-items:center;">
            <img src="${i.img}" style="width:50px; height:50px;">
            <div style="flex:1;">
                <div style="font-size:0.75rem;">${i.name}</div>
                <div style="font-size:0.6rem; color:var(--fire-glow)">SIZE: ${i.size} | QTY: ${i.qty}</div>
                <span style="color:#ff4500; font-size:0.6rem; cursor:pointer;" onclick="removeFromCart(${i.id})">[REMOVE]</span>
            </div>
            <div style="font-size:0.8rem;">$${i.qty * 95}</div>
        </div>
    `).join('');
    document.getElementById('cart-total').innerText = `$${cart.reduce((s, i) => s + (i.qty * 95), 0)}.00`;
}

// FRACTAL ENGINE
const canvas = document.getElementById('fractalCanvas');
const ctx = canvas.getContext('2d');
let w, h, worldY = 0, lastTreeY = 0, time = 0, treeSegments = [], particles = [];
function resize() { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; }
window.addEventListener('resize', resize);
class FlameSpike {
    constructor(x, y, vx, vy) { this.x = x; this.y = y; this.vx = vx; this.vy = vy; this.life = 1.0; this.size = Math.random() * 4 + 2; this.decay = Math.random() * 0.04 + 0.02; }
    update() { this.x += this.vx + Math.sin(time * 0.5) * 2; this.y += this.vy; this.life -= this.decay; }
    draw() { const sy = this.y - worldY; ctx.fillStyle = this.life > 0.6 ? "#fff" : (this.life > 0.3 ? "#ffae00" : "#ff4500"); ctx.beginPath(); ctx.moveTo(this.x, sy); ctx.lineTo(this.x + this.size, sy + this.size * 3); ctx.lineTo(this.x - this.size, sy + this.size * 3); ctx.fill(); }
}
function generateTree(x, y, angle, len, depth) {
    if (depth > 8) return;
    const x2 = x + Math.cos(angle) * len; const y2 = y + Math.sin(angle) * len;
    treeSegments.push({ x1: x, y1: y, x2: x2, y2: y2, depth: depth });
    if (Math.random() > 0.1) generateTree(x2, y2, angle - 0.4 + Math.random()*0.2, len * 0.75, depth + 1);
    if (Math.random() > 0.1) generateTree(x2, y2, angle + 0.4 - Math.random()*0.2, len * 0.75, depth + 1);
}
function loop() {
    time++; worldY -= 8;
    if (lastTreeY > worldY - h) { generateTree(w/2 + Math.sin(worldY*0.001)*200, lastTreeY, -Math.PI/2, 130, 0); lastTreeY -= 400; }
    ctx.fillStyle = "#000"; ctx.fillRect(0, 0, w, h);
    treeSegments.forEach(s => { const sy1 = s.y1 - worldY; const sy2 = s.y2 - worldY; if (sy1 < h + 100 && sy2 > -100) { ctx.strokeStyle = `rgb(255, ${50 - s.depth*5}, 0)`; ctx.lineWidth = Math.max(1, 8 - s.depth); ctx.beginPath(); ctx.moveTo(s.x1, sy1); ctx.lineTo(s.x2, sy2); ctx.stroke(); if (Math.random() > 0.8) particles.push(new FlameSpike(s.x1 + (s.x2-s.x1)*Math.random(), s.y1 + (s.y2-s.y1)*Math.random(), 0, -5)); } });
    particles = particles.filter(p => p.life > 0); particles.forEach(p => { p.update(); p.draw(); });
    if(treeSegments.length > 500) treeSegments.splice(0, 20);
    requestAnimationFrame(loop);
}

resize(); lastTreeY = h; generateTree(w/2, h, -Math.PI/2, 120, 0); loop(); fetchStore(0);
</script>
</body>
</html>
